<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager - Settings</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/quick-actions.css">
    <link rel="stylesheet" href="/static/css/sync.css">
    <style>
        .settings-sections {
            margin-top: 20px;
        }
        
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            margin-top: 20px;
        }
        
        .section-header:first-of-type {
            margin-top: 0;
        }
        
        .section-header:hover {
            opacity: 0.95;
        }
        
        .section-header h3 {
            margin: 0;
            font-size: 1.2em;
        }
        
        .section-toggle {
            font-size: 1.2em;
            transition: transform 0.3s;
        }
        
        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }
        
        .section-content {
            background: white;
            border: 1px solid #e5e5e5;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-content.collapsed {
            display: none;
        }
        
        .save-indicator {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background: #28a745;
            color: white;
            border-radius: 4px;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .save-indicator.show {
            opacity: 1;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .settings-actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px;
            border-top: 2px solid #e5e5e5;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 30px -20px -20px -20px;
        }
        
        .unsaved-changes {
            background: #fff3cd;
            color: #856404;
            padding: 8px 15px;
            border-radius: 4px;
            margin-left: auto;
            display: none;
        }
        
        .unsaved-changes.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Mobile Hamburger Menu -->
    <button id="hamburgerMenu" class="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <a href="/" class="sidebar-logo">
                <span class="nav-icon">üìã</span>
                <h1>Task Manager</h1>
            </a>
            <button id="sidebarToggle" class="sidebar-toggle">
                <span class="toggle-icon">‚óÄ</span>
            </button>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item">
                <a href="/" class="nav-link" data-tooltip="Dashboard">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/objectives" class="nav-link" data-tooltip="Objectives">
                    <span class="nav-icon">üéØ</span>
                    <span class="nav-text">Objectives</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/projects" class="nav-link" data-tooltip="Projects">
                    <span class="nav-icon">üìÅ</span>
                    <span class="nav-text">Projects</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/tasks" class="nav-link" data-tooltip="Tasks">
                    <span class="nav-icon">‚úÖ</span>
                    <span class="nav-text">Tasks</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/teams" class="nav-link" data-tooltip="Teams">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Teams</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/deals" class="nav-link" data-tooltip="Deals">
                    <span class="nav-icon">üíº</span>
                    <span class="nav-text">Deals</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/reports" class="nav-link" data-tooltip="Reports">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Reports</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="/settings" class="nav-link active" data-tooltip="Settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Overlay for mobile -->
    <div id="sidebarOverlay" class="overlay"></div>
    
    <!-- Main Content -->
    <div id="mainContent" class="main-content">
        <div class="content-container">
        <h2>Settings</h2>
        
        <div class="settings-sections">
            <!-- AI Configuration Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>ü§ñ AI Configuration</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div id="aiStatusMessage" style="padding: 10px; margin-bottom: 15px; border-radius: 4px; display: none;"></div>
                <form id="apiSettingsForm">
                    <div class="form-group">
                        <label for="aiProvider">AI Provider</label>
                        <select id="aiProvider" class="form-control">
                            <option value="claude">Claude (Anthropic API)</option>
                            <option value="none">None (Template-Based)</option>
                        </select>
                        <small>Choose your AI provider for task analysis</small>
                    </div>
                    <div id="claudeConfig" class="form-group">
                        <label for="apiKey">Claude API Key</label>
                        <input type="password" id="apiKey" placeholder="sk-ant-...">
                        <small>Enter your Anthropic API key for Claude features</small>
                    </div>
                    <div id="noneConfig" class="form-group" style="display: none;">
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <strong>Template-Based Mode</strong>
                            <p style="margin-top: 10px; margin-bottom: 0;">Uses pre-built templates without AI. Fast and private, provides basic task summaries and follow-up templates.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button type="submit" class="btn btn-primary">Save AI Settings</button>
                        <button type="button" id="testApiKeyBtn" class="btn btn-secondary">Test Configuration</button>
                        <span class="save-indicator" id="aiSaveIndicator">‚úì Saved</span>
                    </div>
                </form>
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <strong>AI Features:</strong>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.6;">
                        <li>AI-powered task summaries on Dashboard</li>
                        <li>Generate follow-up messages for tasks</li>
                        <li>Enhance task descriptions with AI</li>
                    </ul>
                    <small style="display: block; margin-top: 10px;">
                        <strong>Claude:</strong> Most powerful, cloud-based, requires API key<br>
                        <strong>None:</strong> Template-based, fastest, no AI required
                    </small>
                </div>
            </div>

            <!-- Notification Settings Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üîî Notifications</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <form id="notificationSettingsForm">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notificationsEnabled">
                            Enable desktop notifications
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="checkInterval">Check interval (minutes)</label>
                        <input type="number" id="checkInterval" min="1" max="1440" value="60">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                        <button type="button" class="btn btn-secondary" onclick="testNotification()">Test Notification</button>
                        <span class="save-indicator" id="notificationSaveIndicator">‚úì Saved</span>
                    </div>
                </form>
            </div>

            <!-- Task Configuration Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üìã Task Configuration</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="config-grid">
                    <div class="settings-card">
                        <h4>Categories</h4>
                        <div id="categoriesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newCategory" placeholder="New category">
                            <button id="addCategoryBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>Statuses</h4>
                        <div id="statusesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newStatus" placeholder="New status">
                            <button id="addStatusBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>Priorities</h4>
                        <div id="prioritiesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newPriority" placeholder="New priority">
                            <button id="addPriorityBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>Tags</h4>
                        <div id="tagsList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newTag" placeholder="New tag">
                            <button id="addTagBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <span class="save-indicator" id="taskConfigSaveIndicator">‚úì Task configuration saved</span>
                </div>
            </div>

            <!-- Funny Character Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>ü§ñ Tasky Character Settings</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <form id="characterSettingsForm">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="characterEnabled" checked>
                            Enable Tasky (Funny Character Assistant)
                        </label>
                        <small>Show occasional fun comments and encouragement</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="characterSoundEnabled">
                            Enable Sound Effects
                        </label>
                        <small>Play subtle sounds when character appears</small>
                    </div>
                    <div class="form-group">
                        <label for="characterFrequency">Appearance Frequency</label>
                        <select id="characterFrequency">
                            <option value="frequent">Frequent (5-15 minutes)</option>
                            <option value="normal" selected>Normal (10-30 minutes)</option>
                            <option value="rare">Rare (30-60 minutes)</option>
                        </select>
                        <small>How often should Tasky appear with comments?</small>
                    </div>
                    <div class="form-group">
                        <button type="button" id="testCharacterBtn" class="btn btn-secondary">Test Character</button>
                        <button type="button" id="syncCommentsBtn" class="btn btn-secondary">Sync Comments from FTP</button>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="submit" class="btn btn-primary">Save Character Settings</button>
                        <span class="save-indicator" id="characterSaveIndicator">‚úì Saved</span>
                    </div>
                </form>
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <small>
                        Tasky will appear randomly with fun facts, jokes, and motivational messages. 
                        Comments are synced from the team FTP server so everyone gets the same jokes!
                        You can dismiss Tasky anytime by clicking the X button.
                    </small>
                </div>
            </div>

            <!-- Deal Configuration Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üíº Deal Configuration</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="config-grid">
                    <div class="settings-card">
                        <h4>Customer Types</h4>
                        <div id="dealCustomerTypesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newDealCustomerType" placeholder="New customer type">
                            <button id="addDealCustomerTypeBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>Deal Types</h4>
                        <div id="dealTypesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newDealType" placeholder="New deal type">
                            <button id="addDealTypeBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>Deal Statuses</h4>
                        <div id="dealStatusesList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newDealStatus" placeholder="New deal status">
                            <button id="addDealStatusBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h4>CSM Locations</h4>
                        <div id="csmLocationsList" class="editable-list"></div>
                        <div class="add-item">
                            <input type="text" id="newCsmLocation" placeholder="New CSM location">
                            <button id="addCsmLocationBtn" class="btn btn-small">Add</button>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <span class="save-indicator" id="dealConfigSaveIndicator">‚úì Deal configuration saved</span>
                </div>
            </div>

            <!-- Task Templates Section -->
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üìù Task Templates</h3>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div id="templatesList" class="templates-list"></div>
                <div class="template-form">
                    <h4>Add New Template</h4>
                    <div class="form-group">
                        <input type="text" id="newTemplateName" placeholder="Template Name">
                    </div>
                    <div class="form-group">
                        <input type="text" id="newTemplateTitle" placeholder="Title Pattern (use {variable} for placeholders)">
                    </div>
                    <div class="form-group">
                        <textarea id="newTemplateDescription" placeholder="Default Description"></textarea>
                    </div>
                    <button id="addTemplateBtn" class="btn btn-primary">Add Template</button>
                    <span class="save-indicator" id="templateSaveIndicator">‚úì Template saved</span>
                </div>
            </div>
        </div>

        <!-- FTP Sync Section -->
        <div class="settings-section">
            <div class="section-header" onclick="toggleSection(this)">
                <h3>üîÑ FTP Sync Configuration</h3>
                <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="section-content">
                <form id="syncSettingsForm">
                    <div class="settings-subsection">
                        <h4>User Settings</h4>
                        <div class="form-group">
                            <label for="syncUserId">Your User ID *</label>
                            <input type="text" id="syncUserId" placeholder="e.g., john" required>
                            <small>Unique identifier for your deals (e.g., your name)</small>
                        </div>
                        <div class="form-group">
                            <label for="syncTeamIds">Team Member IDs</label>
                            <input type="text" id="syncTeamIds" placeholder="e.g., john, sarah, mike">
                            <small>Comma-separated list of all team member IDs</small>
                        </div>
                    </div>

                    <div class="settings-subsection">
                        <h4>FTP Connection</h4>
                        <div class="form-group">
                            <label for="ftpHost">FTP Host *</label>
                            <input type="text" id="ftpHost" placeholder="ftp.example.com" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ftpPort">Port</label>
                                <input type="number" id="ftpPort" value="21">
                            </div>
                            <div class="form-group">
                                <label for="ftpUsername">Username *</label>
                                <input type="text" id="ftpUsername" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ftpPassword">Password</label>
                            <input type="password" id="ftpPassword" placeholder="Leave blank to keep existing">
                            <small>Password is encrypted and stored locally</small>
                        </div>
                        <div class="form-group">
                            <label for="ftpRemoteDir">Remote Directory</label>
                            <input type="text" id="ftpRemoteDir" value="/shared/taskmanager/deals/">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="ftpUseTls" checked> Use FTPS (Secure FTP)
                            </label>
                            <small>Recommended - Most FTP servers require TLS/SSL</small>
                        </div>
                    </div>

                    <div class="settings-subsection">
                        <h4>Sync Settings</h4>
                        <div class="form-group">
                            <label for="syncConflictStrategy">Conflict Resolution</label>
                            <select id="syncConflictStrategy">
                                <option value="newest_wins">Newest Wins (Recommended)</option>
                                <option value="merge_all">Merge All Fields</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="syncKeepDays">Keep Files For (days)</label>
                                <input type="number" id="syncKeepDays" value="7" min="1" max="30">
                            </div>
                            <div class="form-group">
                                <label for="syncAutoInterval">Auto-Sync Interval (seconds)</label>
                                <input type="number" id="syncAutoInterval" value="300" min="60">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Sync Settings</button>
                        <button type="button" id="testFtpBtn" class="btn btn-secondary">Test FTP Connection</button>
                        <span class="save-indicator" id="syncSaveIndicator">‚úì Settings saved</span>
                    </div>
                </form>

                <!-- Sync Log Viewer -->
                <div class="settings-subsection" style="margin-top: 30px;">
                    <h4>Sync Activity Log 
                        <button id="refreshSyncLogBtn" class="btn btn-sm" style="margin-left: 10px;">üîÑ Refresh</button>
                    </h4>
                    <div id="syncLogContainer" class="sync-log-container">
                        <!-- Sync log will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-actions">
            <button id="saveAllBtn" class="btn btn-primary btn-large">üíæ Save All Changes</button>
            <button id="resetBtn" class="btn btn-secondary">Reset to Defaults</button>
            <span class="unsaved-changes" id="unsavedIndicator">‚ö†Ô∏è You have unsaved changes</span>
        </div>
        </div>
    </div>

    <script>
        function toggleSection(header) {
            header.classList.toggle('collapsed');
            header.nextElementSibling.classList.toggle('collapsed');
        }
    </script>
    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/settings.js"></script>
    <script src="/static/js/quick-actions.js"></script>
    <script src="/static/js/funny_character.js"></script>
</body>
</html>